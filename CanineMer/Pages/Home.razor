@page "/"
@using System.Linq

<PageTitle>Canine Maintenance Energy Requirement Calculator</PageTitle>

<h1>Canine Maintenance Energy Requirement Calculator</h1>
<h2>The MER Calculator is a practical tool for managing canine nutrition and health.</h2>
<hr />
<p>Input a dog's weight and lifestyle to see his or her maintenance energy requirement.</p>

<p>
    <label>
        Dog's Weight in Pounds:
        <input type="number" @bind="InputValue" @bind:event="oninput" />
    </label>
</p>

@if (InputValue > 0)
{
    <p>
        <label>
            Dog's life stage:
            <select @bind="SelectedType">
                <option value="0">Select a value</option>
                @foreach (var factor in Enum.GetValues(typeof(LifeStageFactorsEnum))
                    .Cast<LifeStageFactorsEnum>()
                    .Where(f => f != LifeStageFactorsEnum.None)
                    .OrderBy(f => f.ToString()))
                {
                    <option value="@((int)factor)">@factor.ToString().AddSpacesToPascalCase()</option>
                }
            </select>
        </label>
    </p>
}

<p class="bg-light px-3">
    <ResultsDisplay Model="ResultsVM" />
</p>

<hr/>

<article>
    <section>
        <h2>Overview</h2>
        <p>The Maintenance Energy Requirement (MER) Calculator is a tool designed to estimate the daily energy needs of dogs. This calculation is based on the Resting Energy Requirement (RER) formula, which is then adjusted to account for the dog's specific life stage, activity level, and physiological status.</p>
    </section>

    <section>
        <h2>Formula</h2>
        <p>The core formula used in this calculator is:</p>
        <p><code>√√ (BW kg × BW kg × BW kg) × 70 = RER</code></p>
    </section>

    <section>
        <h2>Purpose of the Calculator</h2>
        <p>The purpose of the MER Calculator is to provide dog owners, breeders, and veterinarians with an estimate of a dog's daily energy needs. Accurate estimation of MER is crucial for:</p>
        <ul>
            <li>Nutrition Planning: Tailoring a dog's diet to meet its specific energy needs.</li>
            <li>Weight Management: Helping maintain optimal body weight, prevent obesity, or support weight loss.</li>
            <li>Health and Welfare: Ensuring dogs receive adequate energy for growth, healing, and overall health.</li>
        </ul>
    </section>

    <section>
        <h2>Usage</h2>
        <p>To use the calculator, input the dog's body weight in pounds. The tool will first calculate the RER and then adjust this value based on the dog's life stage and other relevant factors to estimate the MER.</p>
    </section>

    <section>
        <h2>Life Stages and Factors</h2>
        <p>The calculator adjusts the RER based on various life stages and factors, such as:</p>
        <ul>
            <li>Neutered Adult</li>
            <li>Active/Working Dogs</li>
            <li>Puppies (age-specific adjustments)</li>
            <li>Pregnant or Lactating Females</li>
        </ul>
        <p>Each life stage or condition has specific multipliers applied to the RER to estimate the MER accurately.</p>
    </section>
</article>
<article class="glossary">
    <h2>Glossary of Terms</h2>
    <dl>
        <div class="glossary-term">
            <dt><dfn>RER (Resting Energy Requirement)</dfn></dt>
            <dd>The estimated amount of energy (in kilocalories) a dog requires at rest in a neutral environment. Calculated as 70 × (body weight in kg)^0.75.</dd>
        </div>
        <div class="glossary-term">
            <dt><dfn>MER Upper Bounds</dfn></dt>
            <dd>The upper limit of estimated daily energy needs, calculated as 110% of the RER adjusted by life stage factors (e.g., Puppy: 3.0, Adult: 1.6, Senior: 1.4).</dd>
        </div>
        <div class="glossary-term">
            <dt><dfn>MER Lower Bounds</dfn></dt>
            <dd>The lower limit of estimated daily energy needs, calculated as 90% of the RER adjusted by life stage factors.</dd>
        </div>
        <div class="glossary-term">
            <dt><dfn>Life Stage Factors</dfn></dt>
            <dd>Multipliers applied to the RER to account for a dog's age and activity level: Puppy (3.0), Adult (1.6), Senior (1.4).</dd>
        </div>
    </dl>
</article>
<p class="text-center"><i>By understanding and applying the principles of RER and MER, caregivers can better meet the dietary needs of dogs, promoting their well-being and longevity.</i></p>
@code {
    private int inputValue;
    private MerCalculatorResultsVM? ResultsVM { get; set; }

    private int _selectedType;
    private int SelectedType
    {
        get => _selectedType;
        set
        {
            _selectedType = value;
            UpdateResults();
        }
    }

    private int InputValue
    {
        get => inputValue;
        set
        {
            inputValue = value;
            UpdateResults();
        }
    }

    protected override void OnInitialized()
    {
        ResultsVM = null;
    }

    private void UpdateResults()
    {
        if (_selectedType > 0 && inputValue > 0)
        {
            ResultsVM = MerCalculatorResultsVM.Calculate((LifeStageFactorsEnum)_selectedType, CanineMerCalculator.LbsToKg(inputValue));
        }
        else
        {
            ResultsVM = null;
        }
        StateHasChanged();
    }
}

